# NFS ì„¤ì • ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

## âœ… ì™„ë£Œëœ ë‹¨ê³„
- [x] DB ì„œë²„ì— NFS ì„œë²„ ì„¤ì¹˜
- [x] /etc/exports ì„¤ì •
- [x] ì›¹ì„œë²„1ì— NFS ë§ˆìš´íŠ¸
- [x] /etc/fstab ìë™ ë§ˆìš´íŠ¸ ì„¤ì •
- [x] .env íŒŒì¼ì— UPLOAD_DIR ì„¤ì •
- [x] ë°±ì—”ë“œ ì¬ì‹œì‘

## ğŸ” ê²€ì¦ ë‹¨ê³„

### 1. NFS ë§ˆìš´íŠ¸ í™•ì¸

**ì›¹ì„œë²„1ì—ì„œ:**
```bash
# ë§ˆìš´íŠ¸ ìƒíƒœ í™•ì¸
df -h | grep nfs
mount | grep nfs
```

**ì˜ˆìƒ ì¶œë ¥:**
```
192.168.132.81:/mnt/shared/uploads on /mnt/shared/uploads type nfs4 (...)
```

### 2. ì“°ê¸° ê¶Œí•œ í…ŒìŠ¤íŠ¸

**ì›¹ì„œë²„1ì—ì„œ:**
```bash
# í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
echo "NFS test from web1" > /mnt/shared/uploads/test_nfs.txt

# íŒŒì¼ í™•ì¸
cat /mnt/shared/uploads/test_nfs.txt

# DB ì„œë²„ì—ì„œë„ í™•ì¸ ê°€ëŠ¥í•œì§€ í…ŒìŠ¤íŠ¸
# (DB ì„œë²„ì—ì„œ)
cat /mnt/shared/uploads/test_nfs.txt
```

### 3. ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸

**ì›¹ì„œë²„1ì—ì„œ:**
```bash
# ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸
ls -la /mnt/shared/uploads/
ls -la /mnt/shared/uploads/profile/
```

**ì˜ˆìƒ ì¶œë ¥:**
```
drwxr-xr-x 3 dbmaster dbmaster 4096 ... profile
```

### 4. ë°±ì—”ë“œ í™˜ê²½ë³€ìˆ˜ í™•ì¸

**ì›¹ì„œë²„1ì—ì„œ:**
```bash
# .env íŒŒì¼ í™•ì¸
cat /home/webmaster/my-app/server/.env | grep UPLOAD_DIR

# PM2 í™˜ê²½ë³€ìˆ˜ í™•ì¸
pm2 env 0 | grep UPLOAD_DIR
```

**ì˜ˆìƒ ì¶œë ¥:**
```
UPLOAD_DIR=/mnt/shared/uploads
```

### 5. ì •ì  íŒŒì¼ ì„œë¹™ í™•ì¸

**ì›¹ì„œë²„1ì—ì„œ:**
```bash
# ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
pm2 logs backend --lines 20

# ì„œë²„ê°€ ì •ìƒ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
curl http://localhost:3000/uploads/test_nfs.txt
```

### 6. ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸

**ë¸Œë¼ìš°ì €ì—ì„œ:**
1. `http://ohun.kr` ë˜ëŠ” `http://192.168.132.185:5173` ì ‘ì†
2. ë¡œê·¸ì¸
3. í”„ë¡œí•„ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™
4. í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œë„
5. ì—…ë¡œë“œ ì„±ê³µ í™•ì¸

**ì›¹ì„œë²„1ì—ì„œ íŒŒì¼ í™•ì¸:**
```bash
# ì—…ë¡œë“œëœ íŒŒì¼ í™•ì¸
ls -la /mnt/shared/uploads/profile/

# íŒŒì¼ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
# íŒŒì¼ëª… í˜•ì‹: {userId}_{timestamp}_{random}.{ext}
```

### 7. ì´ë¯¸ì§€ URL ì ‘ê·¼ í…ŒìŠ¤íŠ¸

**ë¸Œë¼ìš°ì €ì—ì„œ:**
- ì—…ë¡œë“œ í›„ ë°˜í™˜ëœ URLë¡œ ì§ì ‘ ì ‘ê·¼
- ì˜ˆ: `http://ohun.kr/uploads/profile/123_1234567890_abc123.jpg`
- ì´ë¯¸ì§€ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

## ğŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: ë§ˆìš´íŠ¸ê°€ ì•ˆ ë³´ì„

```bash
# ìˆ˜ë™ ë§ˆìš´íŠ¸ ì‹œë„
sudo mount -t nfs 192.168.132.81:/mnt/shared/uploads /mnt/shared/uploads

# ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
dmesg | tail -20
```

### ë¬¸ì œ 2: ê¶Œí•œ ê±°ë¶€

```bash
# DB ì„œë²„ì—ì„œ ê¶Œí•œ í™•ì¸
sudo ls -la /mnt/shared/uploads

# í•„ìš”ì‹œ ê¶Œí•œ ìˆ˜ì •
sudo chmod -R 777 /mnt/shared/uploads  # í…ŒìŠ¤íŠ¸ìš©
```

### ë¬¸ì œ 3: íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨

```bash
# ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
pm2 logs backend --lines 50

# í™˜ê²½ë³€ìˆ˜ í™•ì¸
pm2 env 0

# ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸
ls -la /mnt/shared/uploads/profile/
```

## âœ… ìµœì¢… í™•ì¸

ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í›„:
- [ ] NFS ë§ˆìš´íŠ¸ ì •ìƒ ì‘ë™
- [ ] íŒŒì¼ ì“°ê¸°/ì½ê¸° ê°€ëŠ¥
- [ ] í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ
- [ ] ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URL ì ‘ê·¼ ê°€ëŠ¥
- [ ] DB ì„œë²„ì—ì„œë„ íŒŒì¼ í™•ì¸ ê°€ëŠ¥
